<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>NetOps - System Audit Logs</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <style>
        @font-face {
            font-family: 'Assistant';
            src: url("{{ url_for('static', filename='fonts/Assistant-Regular.ttf') }}") format('truetype');
            font-weight: 400;
        }
        @font-face {
            font-family: 'Assistant';
            src: url("{{ url_for('static', filename='fonts/Assistant-Bold.ttf') }}") format('truetype');
            font-weight: 700;
        }

        body { 
            font-family: 'Assistant', sans-serif !important; 
            background-color: #0f172a; 
            color: #f8fafc; 
            padding: 20px;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-grow: 1;
            flex-direction: column;
            overflow: hidden;
        }

        .glass-panel { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.05); 
        }

        .search-input { 
            background: rgba(15, 23, 42, 0.6); 
            border: 1px solid #334155; 
            color: white; 
            transition: all 0.2s;
        }
        .search-input:focus { 
            border-color: #6366f1; 
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.15);
            outline: none;
        }

        /* 注爪 砖专转 */
        .audit-row { transition: background-color 0.2s; border-bottom: 1px solid rgba(51, 65, 85, 0.4); }
        .audit-row:hover { background-color: rgba(99, 102, 241, 0.05); }

        /* ' 驻注转 */
        .badge { padding: 2px 10px; border-radius: 999px; font-size: 10px; font-weight: 800; text-transform: uppercase; border: 1px solid transparent; }
        .badge-approve { color: #10b981; background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.2); }
        .badge-reject { color: #ef4444; background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.2); }
        .badge-sync { color: #6366f1; background: rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.2); }
        .badge-default { color: #94a3b8; background: rgba(148, 163, 184, 0.1); border-color: rgba(148, 163, 184, 0.2); }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        .dir-ltr { direction: ltr; text-align: left; }
    </style>
</head>
<body class="bg-transparent">

    <div class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0">
        <div>
            <h1 class="text-2xl font-bold text-indigo-400 flex items-center gap-3">
                <span class="p-2 bg-indigo-500/10 rounded-lg text-xl"></span>  拽专转 注专转
            </h1>
            <p class="text-slate-500 text-sm mt-1">转注  砖 驻注转  砖 拽驻专爪</p>
        </div>

        <div class="relative w-full md:w-80">
            <span class="absolute inset-y-0 right-3 flex items-center text-slate-500"></span>
            <input type="text" id="auditSearch" oninput="filterAudit()" 
                   placeholder="驻砖 驻砖 (砖转砖, 驻注, 砖...)" 
                   class="search-input w-full pr-10 pl-4 py-2.5 rounded-xl text-sm">
        </div>
    </div>

    <div class="flex-1 overflow-hidden glass-panel rounded-2xl flex flex-col shadow-2xl">
        <div class="overflow-auto custom-scroll">
            <table class="w-full text-right border-collapse">
                <thead class="bg-slate-900/80 sticky top-0 z-20 border-b border-slate-700 shadow-sm">
                    <tr class="text-slate-400 text-[11px] uppercase tracking-wider">
                        <th class="p-4 w-40"> 专注</th>
                        <th class="p-4 w-32">砖转砖</th>
                        <th class="p-4 w-40">住 驻注</th>
                        <th class="p-4 w-48">砖 / 拽</th>
                        <th class="p-4">驻专 </th>
                    </tr>
                </thead>
                <tbody id="audit-body">
                    {% if logs %}
                        {% for log in logs %}
                        <tr class="audit-row text-sm">
                            <td class="p-4 text-slate-500 font-mono text-xs dir-ltr">
                                {{ log.timestamp.strftime('%d/%m/%Y %H:%M:%S') }}
                            </td>
                            <td class="p-4">
                                <div class="flex items-center gap-2">
                                    <span class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px] border border-slate-600"></span>
                                    <span class="font-bold text-slate-200">{{ log.user }}</span>
                                </div>
                            </td>
                            <td class="p-4">
                                {% set action = log.action | upper %}
                                <span class="badge 
                                    {% if 'APPROVE' in action %}badge-approve
                                    {% elif 'REJECT' in action %}badge-reject
                                    {% elif 'SYNC' in action %}badge-sync
                                    {% else %}badge-default{% endif %}">
                                    {{ log.action }}
                                </span>
                            </td>
                            <td class="p-4 font-mono text-xs text-indigo-300">
                                {{ log.resource_name or 'System' }}
                            </td>
                            <td class="p-4 text-slate-400 text-xs italic leading-relaxed">
                                {{ log.details or '-' }}
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr id="empty-state">
                            <td colspan="5" class="p-20 text-center">
                                <div class="opacity-20 text-6xl mb-4"></div>
                                <p class="text-slate-500 font-medium italic"> 爪 驻注转  拽专转.</p>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="mt-4 flex justify-between items-center px-2 shrink-0">
        <div class="text-[10px] text-slate-600 font-mono uppercase tracking-widest">
            Last updated: {{ now if now else 'Live' }}
        </div>
        <div id="row-count" class="text-xs text-slate-500 bg-slate-800/50 px-3 py-1 rounded-lg border border-slate-700">
            爪 {{ logs|length }} 专砖转
        </div>
    </div>

    <script>
        /**
         * 住 转 转 拽专转  转 驻 拽 砖转砖.
         * @function filterAudit
         */
        function filterAudit() {
            const input = document.getElementById('auditSearch');
            const filter = input.value.toLowerCase();
            const tbody = document.getElementById('audit-body');
            const rows = tbody.getElementsByTagName('tr');
            let visibleCount = 0;

            for (let i = 0; i < rows.length; i++) {
                if (rows[i].id === 'empty-state') continue;

                const text = rows[i].textContent.toLowerCase();
                if (text.includes(filter)) {
                    rows[i].style.display = "";
                    visibleCount++;
                } else {
                    rows[i].style.display = "none";
                }
            }

            document.getElementById('row-count').innerText = `爪 ${visibleCount} 专砖转`;
        }

        /**
         * 注  砖 祝 (驻注 -5 拽转)
         */
        setTimeout(() => {
            window.location.reload();
        }, 300000);
    </script>
</body>
</html>